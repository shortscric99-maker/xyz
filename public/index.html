<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CricScore Pro</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="app-header">
            <h1 id="header-title" onclick="window.location.hash=''">CricScore üèè</h1>
        </header>

        <main id="main-container">
            <!-- Dashboard, Create, Toss views remain same (hidden for brevity in this snippet) -->
            <section id="view-dashboard" class="view active">
                <!-- Same as previous -->
                <div class="hero">
                    <h2>Professional Cricket Scoring</h2>
                    <button id="btn-create-match" class="primary-btn large">Start New Match</button>
                </div>
            </section>
            
            <section id="view-create" class="view hidden">
                 <!-- Same as previous -->
                 <div class="header-row"><h2>Match Details</h2><button class="back-btn" onclick="window.location.hash=''">Cancel</button></div>
                 <form id="create-match-form">
                    <!-- ... Inputs for Title, Venue, Date, Overs ... -->
                    <div class="form-group"><input type="text" id="match-title" placeholder="Match Title" required></div>
                    <div class="form-group"><input type="text" id="venue" placeholder="Venue"></div>
                    <div class="row"><input type="date" id="match-date"><input type="number" id="overs" value="20" placeholder="Overs"></div>
                    
                    <!-- Team Inputs -->
                    <div class="team-setup-container">
                        <div class="team-card">
                            <input type="text" id="team1-name" placeholder="Team A Name" required>
                            <textarea id="team1-players-raw" placeholder="Paste Players..." rows="4"></textarea>
                            <button type="button" class="secondary-btn" onclick="parsePlayers('team1')">Confirm Team A</button>
                            <div id="team1-roles" class="hidden">
                                <label>Capt: <select id="team1-captain"></select></label>
                                <label>WK: <select id="team1-wk"></select></label>
                            </div>
                        </div>
                        <div class="team-card">
                            <input type="text" id="team2-name" placeholder="Team B Name" required>
                            <textarea id="team2-players-raw" placeholder="Paste Players..." rows="4"></textarea>
                            <button type="button" class="secondary-btn" onclick="parsePlayers('team2')">Confirm Team B</button>
                            <div id="team2-roles" class="hidden">
                                <label>Capt: <select id="team2-captain"></select></label>
                                <label>WK: <select id="team2-wk"></select></label>
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="primary-btn">Create Match</button>
                 </form>
            </section>

            <section id="view-toss" class="view hidden">
                <!-- Same as previous, ensured ID match -->
                <h2>Toss</h2>
                <div id="toss-winner-options" class="toggle-group"></div>
                <div id="toss-decision-options" class="toggle-group">
                    <button class="toss-btn" onclick="selectTossDecision('bat', this)">Bat</button>
                    <button class="toss-btn" onclick="selectTossDecision('bowl', this)">Bowl</button>
                </div>
                <div id="opener-selection" class="hidden">
                    <select id="select-striker"></select>
                    <select id="select-non-striker"></select>
                    <select id="select-bowler"></select>
                </div>
                <button id="confirm-toss-btn" class="primary-btn" onclick="finalizeToss()" disabled>Start</button>
            </section>

            <!-- 4. Live Match View (UPDATED) -->
            <section id="view-match" class="view hidden">
                <div class="score-card-live">
                    <!-- Batting Card -->
                    <div class="team-header-card batting-card">
                        <div class="team-flag" id="batting-team-name">BAT</div>
                        <div class="main-score">
                            <span id="score-display">0/0</span>
                            <span id="overs-display" class="sub-text">(0.0)</span>
                        </div>
                        <div class="crr-display">CRR: <span id="crr">0.0</span></div>
                    </div>

                    <!-- Bowling Card (NEW) -->
                    <div class="team-header-card bowling-card">
                        <div class="team-flag" id="bowling-team-name">BWL</div>
                        <div class="bowling-details">
                            <span>Extras: <strong id="extras-display">0</strong></span>
                            <span>Target: <strong id="target-display">-</strong></span>
                        </div>
                    </div>

                    <!-- Batsmen Table -->
                    <div class="batsmen-table">
                        <div class="table-row header"><span>Batter</span><span>R</span><span>B</span><span>4s</span><span>6s</span></div>
                        <div class="table-row active" id="striker-row">
                            <span class="p-name" id="striker-name">Striker</span>
                            <span id="s-runs">0</span><span id="s-balls">0</span><span id="s-4s">0</span><span id="s-6s">0</span>
                        </div>
                        <div class="table-row" id="non-striker-row">
                            <span class="p-name" id="ns-name">Non-Striker</span>
                            <span id="ns-runs">0</span><span id="ns-balls">0</span><span id="ns-4s">0</span><span id="ns-6s">0</span>
                        </div>
                    </div>

                    <!-- Current Bowler -->
                    <div class="bowler-strip" id="bowler-row">
                        <span class="p-name" id="bowler-name">Bowler</span>
                        <span class="b-stats" id="bowler-stats">0-0-0-0</span>
                    </div>

                    <div id="recent-balls" class="ball-row"></div>
                </div>

                <!-- Scorer Pad -->
                <div id="scorer-controls" class="scorer-pad hidden">
                    <div class="pad-grid">
                        <button class="run-btn" onclick="recordScore(0)">0</button>
                        <button class="run-btn" onclick="recordScore(1)">1</button>
                        <button class="run-btn" onclick="recordScore(2)">2</button>
                        <button class="run-btn" onclick="recordScore(3)">3</button>
                        <button class="run-btn boundary-4" onclick="recordScore(4)">4</button>
                        <button class="run-btn boundary-6" onclick="recordScore(6)">6</button>
                        <button class="extra-btn" onclick="recordScore(0, 'WD')">WD</button>
                        <button class="extra-btn" onclick="recordScore(0, 'NB')">NB</button>
                        <button class="extra-btn" onclick="recordScore(0, 'B')">BYE</button>
                        <button class="extra-btn" onclick="recordScore(0, 'LB')">LB</button>
                        <button class="wicket-btn" onclick="openWicketModal()">OUT</button>
                        <button class="action-btn" onclick="undoLastBall()">UNDO</button>
                    </div>
                    <div class="controls-footer">
                        <button class="secondary-btn small" onclick="openBowlerModal(true)">Change Bowler</button>
                        <button class="secondary-btn small" onclick="shareMatch()">Share Link</button>
                    </div>
                </div>
            </section>
        </main>

        <!-- Wicket Modal -->
        <div id="modal-wicket" class="modal hidden">
            <div class="modal-content">
                <h3>Wicket Fall</h3>
                <label>Dismissal Type:
                    <select id="dismissal-type" onchange="toggleFielderInput()">
                        <option value="caught">Caught</option>
                        <option value="bowled">Bowled</option>
                        <option value="lbw">LBW</option>
                        <option value="runout">Run Out</option>
                        <option value="stumped">Stumped</option>
                        <option value="hitwicket">Hit Wicket</option>
                    </select>
                </label>
                
                <div id="fielder-div" class="hidden-input">
                    <label>Fielder/Keeper: <select id="fielder-select"></select></label>
                </div>

                <div id="runout-batsman-div" class="hidden-input hidden">
                    <label>Who got out?
                        <select id="runout-batsman-select"></select>
                    </label>
                </div>

                <label>New Batter:
                    <select id="new-batter-select"></select>
                </label>

                <div class="modal-actions">
                    <button class="secondary-btn" onclick="closeModal('modal-wicket')">Cancel</button>
                    <button class="primary-btn" onclick="confirmWicket()">Confirm OUT</button>
                </div>
            </div>
        </div>

        <!-- New Bowler Modal -->
        <div id="modal-bowler" class="modal hidden">
            <div class="modal-content">
                <h3>Select New Bowler</h3>
                <label>Bowler: <select id="next-bowler-select"></select></label>
                <div class="modal-actions">
                    <button class="primary-btn" onclick="confirmNewBowler()">Start Over</button>
                </div>
            </div>
        </div>

        <!-- Notification Toast -->
        <div id="toast" class="toast hidden">Link Copied!</div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="firebase-service.js"></script>
    <script src="cricket.js"></script>
    <script src="app.js"></script>
</body>
                        </html>
